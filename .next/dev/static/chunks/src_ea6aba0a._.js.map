{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/christiancoli/finny-web/src/lib/supabase.ts"],"sourcesContent":["import { createBrowserClient } from \"@supabase/auth-helpers-nextjs\";\n\nexport const supabase = createBrowserClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n"],"names":[],"mappings":";;;;AAGE;AAHF;AAAA;;AAEO,MAAM,WAAW,IAAA,0NAAmB"}},
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///Users/christiancoli/finny-web/src/app/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { Bell, Send, User, Loader2 } from \"lucide-react\";\nimport { supabase } from \"@/lib/supabase\";\nimport { useRouter } from \"next/navigation\";\n\ntype Message = {\n  id: string;\n  role: \"user\" | \"assistant\";\n  content: string;\n  transaction?: {\n    amount_cents: number;\n    merchant: string;\n  };\n};\n\nexport default function ChatPage() {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [insightCount, setInsightCount] = useState(2); // Mock count\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const router = useRouter();\n\n  // Verifica sessione e carica storico (mock per ora o reale se implementato)\n  useEffect(() => {\n    const checkAuth = async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        router.push(\"/login\");\n      }\n    };\n    checkAuth();\n    \n    // Inizializza con messaggi di benvenuto se vuoto\n    setMessages([\n      { id: \"1\", role: \"assistant\", content: \"Hey Cleo, come vanno le finanze oggi?\" },\n      { id: \"2\", role: \"assistant\", content: \"Spero tu non abbia comprato l'ennesima pizza a mezzanotte...\" }\n    ]);\n  }, [router]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const handleSend = async () => {\n    if (!input.trim() || loading) return;\n\n    const userMsgText = input;\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: \"user\",\n      content: userMsgText,\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setInput(\"\");\n    setLoading(true);\n\n// #region agent log\nconst logStart = {location:'app/page.tsx:67',message:'Fetch Start',data:{url:'/api/chat'},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'3'};\nconsole.log('DEBUG:', logStart);\nfetch('http://127.0.0.1:7244/ingest/96758caa-5fa3-4088-b7e9-c48caeafa71c',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(logStart)}).catch(()=>{});\n// #endregion\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      const response = await fetch(\"/api/chat\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": `Bearer ${session?.access_token}`\n        },\n        body: JSON.stringify({\n          message: userMsgText,\n          history: messages.map(m => ({ role: m.role, content: m.content }))\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || \"Errore API\");\n      }\n\n      const result = await response.json();\n      \n      const assistantMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        role: \"assistant\",\n        content: result.assistant_message,\n      };\n\n      // Estrai prima transazione se presente\n      const transAction = result.actions?.find((a: any) => a.type === \"create_transaction\");\n      if (transAction) {\n        assistantMessage.transaction = {\n          amount_cents: transAction.data.amount_cents,\n          merchant: transAction.data.merchant\n        };\n      }\n\n      setMessages((prev) => [...prev, assistantMessage]);\n\n    } catch (err: any) {\n      console.error(err);\n      setMessages((prev) => [...prev, {\n        id: \"err\",\n        role: \"assistant\",\n        content: `Scusa, ho avuto un problema: ${err.message}. Riprova tra un attimo?`\n      }]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <main className=\"flex flex-col h-screen bg-finny-gradient max-w-md mx-auto shadow-2xl relative overflow-hidden font-sans\">\n      {/* Header */}\n      <header className=\"flex justify-end items-center p-4 pt-8 shrink-0\">\n        <div className=\"flex items-center space-x-4\">\n          <button className=\"relative p-2 bg-white/50 rounded-full hover:bg-white/70 transition-colors\">\n            <Bell className=\"w-6 h-6 text-finny-accent\" />\n            {insightCount > 0 && (\n              <span className=\"absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full border-2 border-[#F5F0E1]\">\n                {insightCount}\n              </span>\n            )}\n          </button>\n          <div className=\"p-1 border-2 border-finny-accent rounded-full bg-white/30\">\n            <User className=\"w-8 h-8 text-finny-accent\" />\n          </div>\n        </div>\n      </header>\n\n      {/* Chat Area */}\n      <section className=\"flex-1 overflow-y-auto px-4 space-y-8 pb-32 pt-4 scrollbar-hide\">\n        {messages.map((msg) => (\n          <div\n            key={msg.id}\n            className={`flex ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n          >\n            <div className={`max-w-[85%] ${msg.role === \"assistant\" ? \"space-y-3\" : \"\"}`}>\n              <div\n                className={`p-4 rounded-[2rem] text-[1.1rem] leading-tight ${\n                  msg.role === \"user\"\n                    ? \"bg-white text-finny-dark shadow-md rounded-tr-none\"\n                    : \"text-finny-dark font-medium\"\n                }`}\n              >\n                {msg.content.split(\"\\n\").map((line, i) => (\n                  <p key={i}>{line}</p>\n                ))}\n              </div>\n\n              {msg.transaction && (\n                <div className=\"inline-flex items-center space-x-2 bg-white/50 backdrop-blur-md px-5 py-2.5 rounded-full border border-white/40 ml-1 shadow-sm\">\n                  <div className=\"w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse\" />\n                  <span className=\"text-sm font-bold text-finny-dark/80\">\n                    Aggiunto: €{(msg.transaction.amount_cents / 100).toFixed(2)} · {msg.transaction.merchant}\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n        {loading && (\n          <div className=\"flex justify-start\">\n            <div className=\"p-4\">\n              <Loader2 className=\"w-6 h-6 text-finny-accent animate-spin opacity-50\" />\n            </div>\n          </div>\n        )}\n        <div ref={messagesEndRef} />\n      </section>\n\n      {/* Composer (WhatsApp style) */}\n      <footer className=\"absolute bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-finny-green via-finny-green/80 to-transparent\">\n        <div className=\"flex items-center space-x-3\">\n          <input\n            type=\"text\"\n            placeholder=\"Chiedimi qualsiasi cosa...\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            onKeyPress={(e) => e.key === \"Enter\" && handleSend()}\n            disabled={loading}\n            className=\"flex-1 bg-white border-none rounded-full px-7 py-4 shadow-xl text-lg focus:outline-none focus:ring-2 focus:ring-finny-accent/30 placeholder:text-gray-400\"\n          />\n          <button\n            onClick={handleSend}\n            disabled={!input.trim() || loading}\n            className=\"bg-finny-accent text-white p-4 rounded-full shadow-2xl disabled:opacity-50 active:scale-90 transition-all transform\"\n          >\n            <Send className=\"w-7 h-7\" />\n          </button>\n        </div>\n      </footer>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}